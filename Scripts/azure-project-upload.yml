 parameters:
  name: ''
  platformStr: ''
  graphics: ''

 steps: 
  # - task: DownloadPipelineArtifact@0
  #   inputs:
  #     artifactName: 'WEB_${{parameters.name}}_${{parameters.graphics}}'
  #     targetPath: 'webgl/${{parameters.name}}'

  # - task: DownloadPipelineArtifact@0
  #   inputs:
  #     artifactName: 'WEB_${{parameters.name}}_CANVAS'
  #     targetPath: 'canvas/${{parameters.name}}'

  - task: DownloadPipelineArtifact@0
    inputs:
      artifactName: '${{parameters.platformStr}}_VST2_${{parameters.name}}_${{parameters.graphics}}'
      targetPath: '$(Build.BinariesDirectory)/VST2'

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: '$(Build.BinariesDirectory)/VST2'
      archiveFile: '$(Build.ArtifactStagingDirectory)/${{parameters.platformStr}}_VST2_${{parameters.name}}_${{parameters.graphics}}.zip' 

 - task: DownloadPipelineArtifact@0
    inputs:
      artifactName: '${{parameters.platformStr}}_VST3_${{parameters.name}}_${{parameters.graphics}}'
      targetPath: '$(Build.BinariesDirectory)/VST3'

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: '$(Build.BinariesDirectory)/VST3'
      archiveFile: '$(Build.ArtifactStagingDirectory)/${{parameters.platformStr}}_VST2_${{parameters.name}}_${{parameters.graphics}}.zip' 

  # - task: DownloadPipelineArtifact@0
  #   inputs:
  #     artifactName: '${{parameters.platformStr}}_VST3_${{parameters.name}}_${{parameters.graphics}}'
  #     targetPath: '$(Build.ArtifactStagingDirectory)'

  # - task: DownloadPipelineArtifact@0
  #   inputs:
  #     artifactName: '${{parameters.platformStr}}_AUv2_${{parameters.name}}_${{parameters.graphics}}'
  #     targetPath: '$(Build.ArtifactStagingDirectory)'

  # - bash: |
  #     sed -i.bak 's,var origin = "/";,var origin = "https://iplug2.github.io/webgl/${{parameters.name}}/";,g' ./webgl/${{parameters.name}}/scripts/${{parameters.name}}-awn.js
  #     # sed -i.bak 's,var origin = "/";,var origin = "https://iplug2.github.io/canvas/${{parameters.name}}/";,g' ./canvas/${{parameters.name}}/scripts/${{parameters.name}}-awn.js
  #     rm  ./webgl/${{parameters.name}}/scripts/*.bak
  #     rm  ./canvas/${{parameters.name}}/scripts/*.bak
  #   displayName: Set origins

  - task: GithubRelease@0
    inputs:
      gitHubConnection: olilarkin
      repositoryName: 'iPlug2/iPlug2.github.io'
      action: 'edit' 
      target: 'master'
      tag: 'latest'
      title: 'iPlug 2 Examples'
      releaseNotes: 'Here you can download binaries of the iPlug 2 examples and tests, built by continuous integration.\n\nNo binaries are code-signed, so they may not work in hosts that require a valid signature.'
      assets: '$(Build.ArtifactStagingDirectory)/*.zip'
      assetUploadMode: 'replace'
      isDraft: true
      isPreRelease: true
      addChangeLog: false